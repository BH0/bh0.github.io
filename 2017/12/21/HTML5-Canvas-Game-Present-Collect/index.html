<html>
<!-- Head tag -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="A blog about programming.">
    <meta name="author" content="BH0">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css" type="text/css" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <link rel="icon" href="favicon/favicon.ico">
    <title>BH0's Personal Blog</title>

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="/css/blog.css">

    

</head>

<body>
    <!-- Menu -->
    <div class="blog-masthead">
    <div class="container row center-xs middle-xs">
        <nav class="blog-nav">
            
                <a class="blog-nav-item" href="/">Home |</a>
            
                <a class="blog-nav-item" href="/archives/">Archives |</a>
            
        </nav>
    </div>
</div>

    <div class="container">
        <!-- Blog Header: title and subtitle -->
	<div class="header">
        	<div class="blog-header">
    <h1 class="blog-title">BH0&#39;s Blog</h1>
    <p class="lead blog-description"></p>
</div>

	</div>
        <div class="row">
            <!-- Main Content -->
            <div class="col-sm-8 blog-main">
		         <div class="mainContent">
	                <div class="blog-post">
    <!-- Title -->
    <h2 class="blog-post-title">
        <a href="/2017/12/21/HTML5-Canvas-Game-Present-Collect/">
            HTML5 Canvas Game - Present Collect
        </a>
    </h2>
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2017-12-21
        
    </p>
    <!-- Content -->
    <p>HTML5 Canvas Game - Present Collect </p>
<p>In this blog post we will create a simple game using HTML5 Canvas and Javascript. You will learn how to deal with objects, organise your code and implementing simple game concepts such as a game loop and collision detection using Javascript. </p>
<p>About our game, the player will be an elf character, and the user will use their mouse (by dragging) to move the player object towards a present which when collided with will increase the score, however if the player object collides with something which is not a present (�bad.jpg�) they will lose a point. </p>
<p>Firstly, we must ensure we have the correct file/folder structure as well as the necessary assets. I�m no artist so you�re welcome to use my �placeholder� graphics which I have provided or use your own assets for graphics. We will be representing each game object by its own file, which will contain a constructor function - checkout my introduction to JS objects post: <a href="https://bh0.github.io/2017/11/10/A-Simplified-Introduction-To-Objects-In-Javascript/">https://bh0.github.io/2017/11/10/A-Simplified-Introduction-To-Objects-In-Javascript/</a> . </p>
<p>Here is what the folder/file structure should look like </p>
<ul>
<li>Images<br>  – bad.jpg<br>  – player.jpg<br>  – present.jpg </li>
<li>objects<br>  – present.js<br>  – hud.js<br>  – elf.js </li>
<li>index.html </li>
<li>main.js </li>
</ul>
<h2 id="Firstly-in-our-index-file-we-have-this-I�m-going-to-skip-the-explanation-as-I-assume-you-know-HTML"><a href="#Firstly-in-our-index-file-we-have-this-I�m-going-to-skip-the-explanation-as-I-assume-you-know-HTML" class="headerlink" title="Firstly, in our index file we have this - I�m going to skip the explanation as I assume you know HTML. "></a>Firstly, in our index file we have this - I�m going to skip the explanation as I assume you know HTML. </h2><p>&lt;!DOCTYPE html&gt;</p>
<html class="no-js" lang=""><br>    <head><br>        <meta charset="utf-8"><br>        <meta http-equiv="x-ua-compatible" content="ie=edge"><br>        <title></title><br>        <meta name="description" content=""><br>        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><br>    </head><br>    <body><br>        <!-- Game View --><br>        <canvas id="canvas" width="640" height="480">Sorry, it seems your browser does not support canvas </canvas><br><br>        <!-- Dependancies --><br><br>        <!-- Music & Sound --><br><br>        <!-- Objects --><br>        <script src="objects/present.js"></script><br>        <script src="objects/hud.js"></script><br>        <script src="objects/elf.js"></script><br><br>        <!-- Main File --><br>        <script src="main.js"></script><br><br>    </body><br></html>

<hr>
<h2 id="The-following-is-our-main-js-file-without-the-game-logic-and-we-will-implement-each-feature-as-we-add-it"><a href="#The-following-is-our-main-js-file-without-the-game-logic-and-we-will-implement-each-feature-as-we-add-it" class="headerlink" title="The following is our main.js file without the game logic and we will implement each feature as we add it. "></a>The following is our main.js file without the game logic and we will implement each feature as we add it. </h2><p>/// Get Canvas &amp; Context<br>var canvas = document.getElementById(“canvas”);<br>var ctx = canvas.getContext(“2d”);</p>
<p>canvas.style.cssText = “border:2px solid black”;</p>
<p>/// Initiallize Objects<br>var elf;<br>var hud;<br>var present = [];</p>
<p>/// Global Variables<br>var fps = 30; // frames per second<br>var canvasWidth = canvas.width;<br>var canvasHeight = canvas.height;<br>var intervals = 0;</p>
<p>function init() {<br>    /// Create Objects</p>
<pre><code>document.addEventListener(&quot;mousemove&quot;, function(e) {
    // elf.move(e);
});
</code></pre><p>}<br>init();</p>
<p>/// Game loop Function<br>function update() {<br>    intervals += 1;</p>
<pre><code>/// Create Objects (Periodically)

/// Move

/// Display
ctx.clearRect(0, 0, canvasWidth, canvasHeight);

/// Collision/s 
</code></pre><p>}</p>
<p>/// Repeatedly call update function (Game Loop)<br>setInterval(update, fps);</p>
<p>/// Global Functions</p>
<hr>
<p>I hope the comments are explanatory enough, notice how I used them to title the sections of the game, this will help us understand where to implement each features code. We are initializing the object�s as either simple variables (<code>var varName</code>) or empty arrays (<code>var arrayName = []</code>) outside of the functions so that we have them in our global scope despite that we aren�t doing anything with them until inside of the functions - for a better understanding of this technique research Javascript hoisting�. You will see how intervals comes into play later on, it is used to simulate a timer. We attach an event listener to the document which will be used for determining the mouse�s position coordinates, we do this in the init function because an event listener will repeatedly listen therefor doesn�t have to be in a loop. �elf.move(e);� doesn�t exist yet so is currently commented out. Remember the �init� only gets called once whereas loop gets called every 30th (you�re welcome change this) frame per millisecond by using �setInterval�. Global functions are where our game functions which don�t have to be inside the game objects them self will go - just about any other function will be local to our game objects. </p>
<p>Here is the player (elf) object�s code which goes inside our elf.js file: </p>
<hr>
<p>function Elf() {<br>    this.position = {<br>        x: canvasWidth/2, y: 350<br>    };<br>    this.width = 30;<br>    this.height = 30;</p>
<pre><code>/// Move Object

this.move = function(e) {
    this.position.x = e.clientX;
    this.position.y = e.clientY;
}

/// Display
var image = new Image();
image.src = &quot;./images/player.jpg&quot;;
this.display = function() {
    ctx.drawImage(image, this.position.x, this.position.y, this.width, this.height);
}
</code></pre><p>}</p>
<hr>
<p>Firstly, we set the starting position of the object, We then move the object by setting this object�s position to the mouse�s position. And then we display the image. Inside our event-listener we can uncomment the �elf.move(e)� line. Also inside our main.js file we have to call the appropriate move function - at the �Display� section after we clear the canvas simply put �elf.display();� - if we put this before we clear the canvas we won�t see anything. And inside our init function at the �Create Objects� section  put �elf = new Elf();�. </p>
<p>If we run our game we should now be able to move a character around the screen (canvas) using our mouse. </p>
<p>It gets better. Lets add in our score just now. Which is pretty simple. Inside our hud.js file put the following code. Don�t forget to create the object by assigning it to the �hud� variable�s value underneath �elf = new Elf();�. </p>
<hr>
<p>function Hud() { // can also double up as a/the GUI<br>    this.score = 0;<br>    this.display = function() {<br>        ctx.font = “40px Arial”;<br>        ctx.fillStyle = “black”;<br>        ctx.fillText(“Score: “+this.score, canvasWidth/2, 100);<br>    }<br>}</p>
<hr>
<p>Now we have one more object to add - and then we will have somewhat of a playable game. We are going to have one present but it will also double up as a �do not collect� object depending on one of its variable�s values - this �do not collect� object will decrease the score when the player collides with it, you can make it whatever you like; a lion, a reindeer, a bomb, you choose. </p>
<hr>
<p>function Present() {<br>    this.badPresent = randomChoice();<br>    this.width = 30;<br>    this.height = 30;</p>
<pre><code>this.position = {
    x: Math.floor(Math.random() * canvasWidth),
    y: Math.floor(Math.random() * canvasHeight)
}

var img = new Image();   // Create new img element
if (this.badPresent) {
    img.src = &apos;./images/bad.jpg&apos;;
} else {
    img.src = &apos;./images/present.jpg&apos;;
}
this.display = function() {
    ctx.drawImage(img, this.position.x, this.position.y, this.width, this.height);
}

this.newPos = function() {
    this.position.y = Math.floor(Math.random() * canvasHeight);
    this.position.x = Math.floor(Math.random() * canvasWidth);
}

/// Collision/s
this.collision = function(other) {
    if (this.position.x &lt; other.position.x + other.width &amp;&amp;
        this.position.x + this.width &gt; other.position.x &amp;&amp;
        this.position.y &lt; this.position.y + this.height &amp;&amp;
        this.height + this.position.y &gt; this.position.y) {
        return true;
    }
}
</code></pre><p>}</p>
<hr>
<h2 id="Notice-the-�badPresent�-value-this-is-what-we-are-using-to-decide-if-we-want-the-player-to-score-a-point-upon-collision-or-not-inside-any-file-you-want-I-chose-underneath-�Global-Variables�-section-inside-main-js-put-the-following-function"><a href="#Notice-the-�badPresent�-value-this-is-what-we-are-using-to-decide-if-we-want-the-player-to-score-a-point-upon-collision-or-not-inside-any-file-you-want-I-chose-underneath-�Global-Variables�-section-inside-main-js-put-the-following-function" class="headerlink" title="Notice the �badPresent� value, this is what we are using to decide if we want the player to score a point upon collision or not, inside any file you want (I chose underneath �Global Variables� section inside main.js)  put the following function. "></a>Notice the �badPresent� value, this is what we are using to decide if we want the player to score a point upon collision or not, inside any file you want (I chose underneath �Global Variables� section inside main.js)  put the following function. </h2><p>/// Global Functions<br>function randomChoice() {<br>    var num = Math.floor(Math.random() * 2);<br>    if (num == 1) {<br>        return true;<br>    } else {<br>        return false;<br>    }<br>}</p>
<hr>
<p>Alright, inside our present object you can see we are setting �badPresent� to the value of this function, this is essentially saying �if badPresent is equal to 1/true the player should lose a point upon collision, otherwise, the player should score a point upon collision�. </p>
<p>Now we have all the code for our individual objects, however we still need to do stuff with these objects to make our game �fun�. </p>
<p>Firstly, we will create a present object every so often (using the modulus operator and the �intervals� variable. Inside our update function put the following code </p>
<hr>
<pre><code>intervals += 1;

/// Create Objects (Periodically)
if (intervals % 120 === 0) {
    present.push(new Present());
}
</code></pre><hr>
<p>Here we are repeatedly adding 1 (incrementing by 1) <em>time unit</em> and within the if statement determining if a certain amount of time (120 <em>time unit</em>) has passed. The reason I said time unit instead of specifying the actual unit is that I don�t know what the actual unit is (math isn�t my strong part right now). Anyway basically when intervals modulus 120 is equal to zero a new present will be added to our array of present objects. The reason we�re using an array is so that it makes it easy for us to remove the objects when we choose to. </p>
<p>We need to display the present object by looping through each object inside our array of objects and ensuring each object �display� function is called (and display the HUD/score) as well. This code will do that - put it under �elf.display();� inside our update�s function  </p>
<hr>
<pre><code>for (var p = 0; p &lt; present.length; p++) {
    present[p].display();
}
hud.display();
</code></pre><hr>
<p>Now that our present objects are visible, our game may end up becoming pretty crowded by the variants of the present object which the player is to avoid, so we after so many milliseconds we will delete a �do not collect� present object - similar to how we are creating the present objects. </p>
<hr>
<pre><code>/// Delete badPresent (to keep the game-world from being overcrowded)
if (intervals % 360 === 0) {
    for (var p = 0; p &lt; present.length; p++) {
        if (present[p].badPresent) {
            present.splice(present.indexOf(present[p].badPresent), 1);
            intervals = 0;
        }
    }
}
</code></pre><hr>
<p>We have to loop through each present object, check if it is a �do not collect� object and remove it using �present.splice�� if so. </p>
<p>Now lets detect for a collision between the player and the present object and adjust the score accordingly - do this inside the main.js file underneath the �Collisions� section. </p>
<hr>
<pre><code>/// Collision/s
for (var p = 0; p &lt; present.length; p++) {
    if (present[p].collision(elf) &amp;&amp; !present[p].badPresent) {
        hud.score++;
        present.splice(present.indexOf(present[p]), 1);
    } else if (present[p].collision(elf) &amp;&amp; present[p].badPresent) {
        hud.score -= 1;
        elf.position.y = 350;
        elf.position.x = canvasWidth/2;
        present[p].newPos();
    }
}
</code></pre><hr>
<p>If our present is not a �do not collect�/bad present object we will delete it from the game world and increase the player�s score, otherwise if it is we will give the present object a new position and decrease the hud.score by 1 (you can simulate a �death� event here if you like). </p>
<p>And congratulations. We now have a playable game. If you want to improve up on it here are some recommendations. Implement more objects (such as trees and other scenery). Implement a �lerp� mechanic which will mean the player (elf) object will gradually move towards the mouse�s position - see: <a href="https://github.com/mattdesl/lerp" target="_blank" rel="external">https://github.com/mattdesl/lerp</a> - if you�re not famillar with Node-Package-Manager simply navigation to �index.js� for the actual code. You could also implement a lives and/or health system (where a life is lost each time the player touches a �do not collect� object). And we could communicate with the user using the �alert� command but it�d be much more impressive if you implemented your own graphical user interface such as a menu system. </p>
<p>I may expand on this tutorial either within this blog post or (a) seperate blog post/s. Thanks for reading. </p>

    <hr />
    <!-- Tags and Categories links -->
    

    

</div>

		           </div> 
            </div>
            <!-- Sidebar -->
            <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
		<div class="sidebar">
	                <div class="sidebar col-xs-2"> 	
	<div class="sidebar-module sidebar-module-inset">
    		<h4>About</h4>
	    	<p> A technology blog. </p>
	</div>
	<div class="sidebar-module">
		<h4>Archives</h4>
    		<ol class="list-unstyled">
		</ol>
	</div>
	<div class="sidebar-module">
    		<h4>Elsewhere</h4>
    		<ol class="list-unstyled">
        		<li><a href="#">GitHub</a></li>
        		<li><a href="#">Twitter</a></li>
        		<!-- <li><a href="#">Facebook</a></li> -->
    		</ol>
	</div>
</div>

		</div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    
    <!-- After footer scripts -->
    
</body>
</html>
